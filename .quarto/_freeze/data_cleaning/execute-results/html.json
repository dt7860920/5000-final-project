{
  "hash": "a5150154e44c06a4f8b6258983bf78d3",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Data Cleaning\"\nformat:\n  html:\n    toc: true\n    code-fold: true\n    embed-resources: true\nexecute:\n  echo: true\n  warning: false\n  message: false\n---\n\n### Data Cleaning\nLoad Data: This step establishes the two primary data sources that will later be merged into a unified dataset for analysis.\n\n::: {#5c3af2ec .cell execution_count=1}\n``` {.python .cell-code}\nimport pandas as pd\nimport numpy as np\n\nraw_path = \"data/raw-data/pgatour_raw.csv\"\nfull_path = \"data/raw-data/pga_full.csv\"\n\ndf_raw = pd.read_csv(raw_path, encoding=\"latin1\")\ndf_full = pd.read_csv(full_path, encoding=\"latin1\")\n```\n:::\n\n\n### Helper Function\nBefore cleaning the data, I define several helper functions designed to standardize formatting across both datasets.\n\n**Clean column names: **\n\n* Converts names to lowercase\n\n* Replaces spaces with underscores\n\n* Removes stray punctuation\n\n* Standardizes percent signs (%)\n\n\n**Clean numeric data: **\n\n* Commas\n\n* Dollar signs\n\n* Percentage symbols\n\n**Clean player name: **\n\n* Extra spaces\n\n* Commas\n\n* Inconsistent capitalization\n\n::: {#e221477f .cell execution_count=2}\n``` {.python .cell-code}\ndef clean_column_names(df):\n    df = df.copy()\n    df.columns = (\n        df.columns\n        .str.strip()\n        .str.lower()\n        .str.replace(\" \", \"_\")\n        .str.replace(\"%\", \"pct\")\n        .str.replace(\".\", \"_\")\n    )\n    return df\n\ndef clean_numeric(series):\n    return (\n        series.astype(str)\n        .str.replace(\",\", \"\", regex=False)\n        .str.replace(\"$\", \"\", regex=False)\n        .str.replace(\"%\", \"\", regex=False)\n        .replace(\"\", np.nan)\n        .astype(float)\n    )\n\ndef clean_player_name(name):\n    name = str(name)\n    name = name.replace(\",\", \"\").strip()\n    return name.title()\n```\n:::\n\n\n### Standardize Player Names\nI apply the name-cleaning function to both datasets, so names can be recignized during the merging process.\n\n::: {#3eceb01d .cell execution_count=3}\n``` {.python .cell-code}\nif \"name\" in df_raw.columns:\n    df_raw[\"name\"] = df_raw[\"name\"].apply(clean_player_name)\nif \"name\" in df_full.columns:\n    df_full[\"name\"] = df_full[\"name\"].apply(clean_player_name)\n```\n:::\n\n\n### Fix Numeric Columns\nI apply the clean_numeric function to standardize all the columns with numeric data\n\n::: {#a9b6063b .cell execution_count=4}\n``` {.python .cell-code}\nnumeric_raw = [\n    \"rounds\", \"scoring\", \"drive_distance\",\n    \"gir_pct\", \"sg_p\", \"sg_ttg\", \"sg_t\",\n    \"top_10\", \"win\"\n]\nnumeric_full = [\n    \"rounds\", \"scoring\", \"birdie_avg\", \"drive_distance\",\n    \"gir_pct\", \"sg_p\", \"sg_ttg\", \"sg_t\",\n    \"top_10\", \"win\"\n]\n\nfor col in numeric_raw:\n    if col in df_raw.columns:\n        df_raw[col] = clean_numeric(df_raw[col])\n\nfor col in numeric_full:\n    if col in df_full.columns:\n        df_full[col] = clean_numeric(df_full[col])\n\n# Year should be numeric\nfor df in [df_raw, df_full]:\n    if \"year\" in df.columns:\n        df[\"year\"] = pd.to_numeric(df[\"year\"], errors=\"coerce\").astype(\"Int64\")\n```\n:::\n\n\n### Standardize Column Names\nI standardized all the column names for both datasets, making the merge process much easier.\n\n::: {#fffc5197 .cell execution_count=5}\n``` {.python .cell-code}\ndf_raw = clean_column_names(df_raw)\ndf_full = clean_column_names(df_full)\n\ndf_full = df_full.rename(columns={\n    \"player\": \"name\",\n    \"scoringavg\": \"scoring\",\n    \"birdieavg\": \"birdie_avg\",\n    \"drivingdistance\": \"drive_distance\",\n    \"gir\": \"gir_pct\",\n    \"girpct\": \"gir_pct\",\n    \"sg_putting\": \"sg_p\",\n    \"sg_total\": \"sg_t\",\n    \"sg_teetogreen\": \"sg_ttg\",\n    \"top10finishes\": \"top_10\",\n    \"wins\": \"win\"\n})\n\n# ---- pgatour_raw.csv ----\ndf_raw = df_raw.rename(columns={\n    \"top_10\": \"top_10\",\n    \"1st\": \"win\",\n    \"1_st\": \"win\",\n    \"1st_\": \"win\",\n    \"gir__pct\": \"gir_pct\",   # depending on how the % got mapped\n    \"gir_pct\": \"gir_pct\",\n    \"fwy__pct\": \"fwy_pct\",\n    \"fwy_pct\": \"fwy_pct\"\n})\n```\n:::\n\n\n### Select Overlapping Features in both Dataset\n* Select the wanted columns\n* Drop all the overlapping features\n\n::: {#b840929f .cell execution_count=6}\n``` {.python .cell-code}\nstandard_cols = [\n    \"name\", \"year\", \"country\",\n    \"scoring\",\n    \"drive_distance\", \"gir_pct\",\n    \"sg_p\", \"sg_ttg\", \"sg_t\",\n    \"top_10\", \"win\"\n]\n\nfor col in standard_cols:\n    if col not in df_raw.columns:\n        df_raw[col] = pd.NA\n    if col not in df_full.columns:\n        df_full[col] = pd.NA\n\ndf_raw_std = df_raw[standard_cols]\ndf_full_std = df_full[standard_cols]\n```\n:::\n\n\n### Data Merging\nMerge both datasets into one uniformed dataframe.\nProblem: I realized that the players who did not win or get top 10 have null in their column instead of one. This will cause en error during the analysis process, so I replaced all the null with 0.\nThen I dropped duplicate players and keep the one with less missing data.\n\n::: {#c5efe948 .cell execution_count=7}\n``` {.python .cell-code}\ncombined = pd.concat([df_raw_std, df_full_std], ignore_index=True)\n\ncombined[\"win\"] = combined[\"win\"].fillna(0).astype(\"Int64\")\ncombined[\"top_10\"] = combined[\"top_10\"].fillna(0).astype(\"Int64\")\n\ncombined[\"non_na_count\"] = combined.notna().sum(axis=1)\n\ncombined = (\n    combined.sort_values([\"name\", \"year\", \"non_na_count\"])\n            .drop_duplicates(subset=[\"name\", \"year\"], keep=\"last\")\n            .drop(columns=\"non_na_count\")\n)\n\nprint(\"Final shape:\", combined.shape)\nprint(combined.head())\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nFinal shape: (2747, 11)\n               name  year country  scoring  drive_distance  gir_pct   sg_p  \\\n0    Aaron Baddeley  2007     AUS   70.088           291.9    60.35  0.629   \n195  Aaron Baddeley  2008     AUS   70.196           290.3    62.02  0.762   \n389  Aaron Baddeley  2009     AUS   71.153           287.8    59.57  0.604   \n571  Aaron Baddeley  2010     AUS   70.995           298.9    64.60  0.509   \n760  Aaron Baddeley  2011     AUS   70.230           296.2    65.48  0.324   \n\n     sg_ttg   sg_t  top_10  win  \n0     0.435  1.064       7    1  \n195   0.123  0.885       3    0  \n389  -0.755 -0.151       2    0  \n571  -0.294  0.208       2    0  \n760   0.824  1.148       5    1  \n```\n:::\n:::\n\n\n## Save Merged Data\n\n::: {#e2a418cf .cell execution_count=8}\n``` {.python .cell-code}\noutput_path = \"data/processed-data/pga_cleaned.csv\"\ncombined.to_csv(output_path, index=False)\noutput_path\n```\n\n::: {.cell-output .cell-output-display execution_count=8}\n```\n'data/processed-data/pga_cleaned.csv'\n```\n:::\n:::\n\n\n## Before & After Comparison\nConfirm the transformation\n\n::: {#f15335d9 .cell execution_count=9}\n``` {.python .cell-code}\ndf_raw.head()\ndf_full.head()\ncombined.head()\n```\n\n::: {.cell-output .cell-output-display execution_count=9}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>name</th>\n      <th>year</th>\n      <th>country</th>\n      <th>scoring</th>\n      <th>drive_distance</th>\n      <th>gir_pct</th>\n      <th>sg_p</th>\n      <th>sg_ttg</th>\n      <th>sg_t</th>\n      <th>top_10</th>\n      <th>win</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>Aaron Baddeley</td>\n      <td>2007</td>\n      <td>AUS</td>\n      <td>70.088</td>\n      <td>291.9</td>\n      <td>60.35</td>\n      <td>0.629</td>\n      <td>0.435</td>\n      <td>1.064</td>\n      <td>7</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>195</th>\n      <td>Aaron Baddeley</td>\n      <td>2008</td>\n      <td>AUS</td>\n      <td>70.196</td>\n      <td>290.3</td>\n      <td>62.02</td>\n      <td>0.762</td>\n      <td>0.123</td>\n      <td>0.885</td>\n      <td>3</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>389</th>\n      <td>Aaron Baddeley</td>\n      <td>2009</td>\n      <td>AUS</td>\n      <td>71.153</td>\n      <td>287.8</td>\n      <td>59.57</td>\n      <td>0.604</td>\n      <td>-0.755</td>\n      <td>-0.151</td>\n      <td>2</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>571</th>\n      <td>Aaron Baddeley</td>\n      <td>2010</td>\n      <td>AUS</td>\n      <td>70.995</td>\n      <td>298.9</td>\n      <td>64.60</td>\n      <td>0.509</td>\n      <td>-0.294</td>\n      <td>0.208</td>\n      <td>2</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>760</th>\n      <td>Aaron Baddeley</td>\n      <td>2011</td>\n      <td>AUS</td>\n      <td>70.230</td>\n      <td>296.2</td>\n      <td>65.48</td>\n      <td>0.324</td>\n      <td>0.824</td>\n      <td>1.148</td>\n      <td>5</td>\n      <td>1</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n# Limitations on data cleaning:\n* Replacing missing wins and top 10s with zero can introduce bias\n* Removing characters like % and $ in the numeric columns may loses context\n* Missing data imputation was not used, leaving missing stats as NaN\n\n",
    "supporting": [
      "data_cleaning_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js\" integrity=\"sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js\" integrity=\"sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}